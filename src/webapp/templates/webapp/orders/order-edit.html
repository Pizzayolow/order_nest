{% extends 'base.html' %}
{% load static %}

{% block title %}
    <title>Modifier commande</title>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.0/jquery-ui.js"></script>
    <script src="{% static 'js/paper-full.min.js' %}"></script>

    <!-- Load the specific script -->
    <script src="{% static 'js/canva.js' %}"></script>
    <script src="{% static 'js/autocomplete.js' %}"></script>

{% endblock %}

{% block content %}
<input type="hidden" id="orderPk" value="{{ order_form.instance.pk }}">

  <h1>Page de modification d'une nouvelle commande {{ order_form.instance.id }} </h1>
    {{ order.created_at }}

<canvas id="drawZone" class="border-2 border-indigo-600"></canvas>
<button id="bt_eraseDrawing">Effacer</button>
<button id="bt_saveDrawing">Sauvegarder</button>

<ul id="canvasList">
    {% if attachments %}
        {% for attachment in attachments %}
            <li><span class="attachment_pk" data-pk="{{ attachment.pk }}">[{{ attachment.pk }}]</span> - {{ attachment.file_name }} <button class="delete_canvas" data-pk="{{ attachment.pk }}"> -> Supprimer</button></li>
        {% endfor %}
    {% endif %}

</ul>



<form method="POST">
    {% csrf_token %}
    <!-- Champs du formulaire NewOrderForm -->
    {{ order_form.label.label_tag }} {{ order_form.label }}
    {% if order_form.label.errors %}
        <div class="errors">{{ order_form.label.errors }}</div>
    {% endif %}

    {{ order_form.comments.label_tag }} {{ order_form.comments }}
    {% if order_form.comments.errors %}
        <div class="errors">{{ order_form.comments.errors }}</div>
    {% endif %}

    {{ order_form.status.label_tag }} {{ order_form.status }}
    {% if order_form.status.errors %}
        <div class="errors">{{ order_form.status.errors }}</div>
    {% endif %}

    {{ order_form.estimated_delivery_date.label_tag }} {{ order_form.estimated_delivery_date }}
    {% if order_form.estimated_delivery_date.errors %}
        <div class="errors">{{ order_form.estimated_delivery_date.errors }}</div>
    {% endif %}

    {{ order_form.invoice_date.label_tag }} {{ order_form.invoice_date }}
    {% if order_form.invoice_date.errors %}
        <div class="errors">{{ order_form.invoice_date.errors }}</div>
    {% endif %}

    <br>
    <!-- Champs du formulaire NewCustomerForm -->

    <label>id</label>
    <input type="number" name="id" value="{{ customer_form.instance.id }}" readonly>


    {{ customer_form.first_name.label_tag }} {{ customer_form.first_name }}
    {% if customer_form.first_name.errors %}
        <div class="errors">{{ customer_form.first_name.errors }}</div>
    {% endif %}

    {{ customer_form.last_name.label_tag }} {{ customer_form.last_name }}
    {% if customer_form.last_name.errors %}
        <div class="errors">{{ customer_form.last_name.errors }}</div>
    {% endif %}

    {{ customer_form.phone_number.label_tag }} {{ customer_form.phone_number }}
    {% if customer_form.phone_number.errors %}
        <div class="errors">{{ customer_form.phone_number.errors }}</div>
    {% endif %}

    {{ customer_form.address.label_tag }} {{ customer_form.address }}
    {% if customer_form.address.errors %}
        <div class="errors">{{ customer_form.address.errors }}</div>
    {% endif %}

    {{ customer_form.mail.label_tag }} {{ customer_form.mail }}
    {% if customer_form.mail.errors %}
        <div class="errors">{{ customer_form.mail.errors }}</div>
    {% endif %}

    <button type="submit" class="btn btn-submit" value="Update">Enregistrer</button>
</form>



{% if product_order %}
<div class="min-w-full bg-white">
  <div class="py-2 align-middle inline-block min-w-full">
    <div class="overflow-hidden">
      <table class="min-w-full">
        <thead>
          <tr>
            <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              ID du produit
            </th>
            <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Référence
            </th>
            <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Libellé
            </th>
            <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Prix unitaire de vente
            </th>
            <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Quantité
            </th>
              <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Modifier
            </th>
              <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Supprimer
            </th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          {% for product in product_order %}
            <tr>
              <td class="px-6 py-4 whitespace-nowrap">
                {{ product.product.pk }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                {{ product.product.reference }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                {{ product.product.label }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                {{ product.product.selling_price_unit }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                {{ product.product.quantity }}
              </td>
                <td class="px-6 py-4 whitespace-nowrap">
                <a href="{% url 'webapp:product-edit' pk=product.product.id %}">
                Modifier
                </a>
               </td>
                <td class="px-6 py-4 whitespace-nowrap">
                <a href="{% url 'webapp:product-delete' pk=product.product.id %}">
                Supprimer
                </a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endif %}

<a href="{% url 'webapp:order-add-products' pk=order_form.instance.id %}">Ajouter Produit</a>


{% endblock %}